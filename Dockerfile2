FROM php:fpm-alpine
RUN apk update && \
  apk upgrade && \
  apk add --no-cache tzdata libzip-dev icu-dev oniguruma-dev libpng-dev libpq-dev libwebp-dev libjpeg-turbo-dev freetype-dev && \
  cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
  apk del tzdata && \
  docker-php-ext-install -j$(nproc) zip intl mbstring mysqli pdo_mysql exif pcntl bcmath gd pdo pdo_pgsql pgsql && \
  docker-php-ext-configure gd --with-webp=/usr/include/webp --with-jpeg=/usr/include --with-freetype=/usr/include/freetype2
RUN pecl install -o -f igbinary && \
  echo yes | pecl install -o -f redis && \
  docker-php-ext-enable igbinary redis
EXPOSE 9000
CMD ["php-fpm"]