FROM php:fpm-alpine
RUN apk update && \
  apk upgrade && \
  apk add --no-cache tzdata libzip-dev icu-dev oniguruma-dev libpng-dev libwebp-dev libjpeg-turbo-dev freetype-dev linux-headers && \
  cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
  apk del tzdata && \
  docker-php-ext-install -j$(nproc) zip intl mbstring mysqli pdo_mysql exif pcntl bcmath sockets gd && \
  docker-php-ext-configure gd --with-webp=/usr/include/webp --with-jpeg=/usr/include --with-freetype=/usr/include/freetype2
RUN echo yes | pecl install -o -f igbinary redis swoole && \
  docker-php-ext-enable igbinary redis swoole && \
  rm -rf /tmp/pear
EXPOSE 9000
CMD ["php-fpm"]